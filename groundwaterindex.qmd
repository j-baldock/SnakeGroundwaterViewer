---
title: "View Groundwater Index"
format: html
---

This page displays the groundwater index for the entire upper Snake River watershed, calculated every 300 meters along the stream network. The value at each point is calculated as the inverse, distance weighted average of all points in the upstream catchment. **We designed the index to reflect the overall effect of groundwater on stream conditions; the index can be interpreted as the relative contribution of groundwater to streamflow**. Ongoing research in the Spread Creek catchment shows a strong positive relationship between the groundwater index and mean summer specific discharge, indicating that locations with high groundwater index values are associated with high summer streamflow relative to their catchment size. 

**Key:** lighter ([yellow-green]{style="color: #C5FA4D;"}) points indicate locations with low groundwater availability, whereas darker ([purple]{style="color: #693CAB;"}) points indicate locations with high groundwater availability.

**Note:** We restricted prediction points to those with catchments less than 500 square kilometers as we assumed groundwater effects on ecosystem processes likely differ between large rivers and smaller tributary streams that were the focus of our study. 

```{r include=FALSE}
library(tidyverse)
library(terra)
library(sf)
library(mapview)
library(viridis)
```

```{r cache=FALSE}
# lakes in Upper Snake
lakes <- vect("data/UpperSnake_Lakes.shp") 

# flowline
flowline <- vect("data/UpperSnake_Flowline.shp")

# Groundwater Index: 5km inverse distance weighted mean
gwmet <- read_sf(dsn = "data", layer = "GroundwaterMetrics_Normalized_PredPoints") %>% mutate(GroundwaterIndex = as.numeric(round(springpr_1, digits = 3)))
gwmet2 <- gwmet[,c("site", "basin_are0", "GroundwaterIndex")]
gwmet3 <- gwmet2[gwmet2$basin_are0 <= 500,] # drop large rivers

# cut lakes from flowline
flowline <- erase(flowline, lakes)

# create map layers
m2 <- mapview(flowline, color = "dodgerblue4", lwd = 2)
m3 <- mapview(lakes, color = "dodgerblue4", lwd = 2, col.regions = "lightblue", alpha.regions = 1)
m4 <- mapview(gwmet3, zcol = "GroundwaterIndex", lwd = 0.75, col.regions = colorRampPalette(rev(viridis(12))), alpha.regions = 1)

# generate map
m2 + m3 + m4
```

